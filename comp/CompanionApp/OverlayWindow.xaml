<Window x:Class="CompanionApp.OverlayWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="KRT Overlay"
        Width="260" SizeToContent="Height"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        Loaded="Window_Loaded">

  <Border x:Name="OverlayBorder" Background="#CC1E1E2E" CornerRadius="6" Padding="8,6" Margin="2">
    <Border.Effect>
      <DropShadowEffect BlurRadius="8" ShadowDepth="1" Opacity="0.4" Color="Black"/>
    </Border.Effect>

    <StackPanel>
      <!-- Header -->
      <TextBlock Text="das-KRT Radio"
                 Foreground="#A0A0B0" FontSize="9" FontWeight="SemiBold"
                 Margin="0,0,0,4" HorizontalAlignment="Left"/>

      <!-- Radio entries container — only active radios, sorted by last activity -->
      <ItemsControl x:Name="RadioItems">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border CornerRadius="3" Padding="6,3" Margin="0,1">
              <Border.Style>
                <Style TargetType="Border">
                  <Setter Property="Background" Value="#22FFFFFF"/>
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding IsReceiving}" Value="True">
                      <Setter Property="Background" Value="#33FF4A4A"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsTransmitting}" Value="True">
                      <Setter Property="Background" Value="#334AFF9E"/>
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>

              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Status indicator dot -->
                <Ellipse Grid.Column="0"
                         Width="6" Height="6" Margin="0,0,5,0"
                         VerticalAlignment="Center">
                  <Ellipse.Style>
                    <Style TargetType="Ellipse">
                      <Setter Property="Fill" Value="#555555"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsReceiving}" Value="True">
                          <Setter Property="Fill" Value="#FF4A4A"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsTransmitting}" Value="True">
                          <Setter Property="Fill" Value="#4AFF9E"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </Ellipse.Style>
                </Ellipse>

                <!-- Radio name on top, freq below -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                  <TextBlock Text="{Binding Label, Mode=OneWay}"
                             Foreground="White" FontSize="10" FontWeight="Medium"
                             LineHeight="12"/>
                  <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding FreqDisplay, Mode=OneWay}"
                               Foreground="#00FF88" FontFamily="Consolas" FontSize="9"
                               LineHeight="11"/>
                    <TextBlock Text="{Binding Hotkey, Mode=OneWay}"
                               Foreground="#666" FontSize="8" Margin="5,0,0,0"
                               VerticalAlignment="Center"
                               Visibility="{Binding HotkeyVisible, Mode=OneWay}"/>
                  </StackPanel>
                </StackPanel>

                <!-- Last transmission — right-aligned, prominent -->
                <TextBlock Grid.Column="2"
                           Text="{Binding LastTransmission, Mode=OneWay}"
                           FontSize="11" FontWeight="SemiBold"
                           HorizontalAlignment="Right" VerticalAlignment="Center"
                           Margin="8,0,0,0"
                           Visibility="{Binding HasLastTransmission, Mode=OneWay}">
                  <TextBlock.Style>
                    <Style TargetType="TextBlock">
                      <Setter Property="Foreground" Value="#DDDDDD"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsReceiving}" Value="True">
                          <Setter Property="Foreground" Value="#FFFFFF"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </TextBlock.Style>
                </TextBlock>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </StackPanel>
  </Border>
</Window>
